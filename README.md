# oVirt VDI Terminal (OVT)

OVT is a Python based shell replacement designed to connect oVirt users into a oVirt based VDI platform. It was built
around the idea that a user may end up at any one of many thin clients running a minimal linux OS, namely CentOS, and
allows them to quickly and easily connect to any virtual machine they have access to within oVirt.

NOTE: This is not an official oVirt project, this was built to address a need that the default ovirt applications do not (yet) provide. Use at your own risk, pull requests welcome!

# TODO
  - Smart Card Authentication (PIV)
  - 802.1x Support
  - Graphical UI (Qt4/Qt5)
  - Python 3 Support (It was built with CentOS in mind, but getting dual Python 2/3 working should be easy enough.)
  - Probably a lot more...

# Getting Started

This guide assumes you are starting with a base minimal install of CentOS 7. You can run this application on top of an existing X session by setting "startx = no" in settings.conf. If you do this you can pretty much ingnore most of the setup here as it is mostly targeted to running OVT as it's own standalone shell without any desktop environment. See settings.conf for more information...

Install a few dependencies / applications. You need an X server and fonts for remote-viewer, as well as pulseaudio for sound support. IW is needed to get NetworkManager to connect to WiFi networks, for whatever reason this is missing from the base minimal install..

```sh
$ sudo yum install epel-release
$ sudo yum groupinstall "X Window System" Fonts
$ sudo yum install python-networkmanager python-six pulseaudio pulseaudio-utils remote-viewer iw
```

By default X will create one screen and span it accross multiple monitors. We want remote-viewer to see each monitor as an individual screen, so a bit of X customizations are needed. Modify this to fit your needs...

```sh
$ vi /etc/X11/xorg.conf.d/10-layout.conf

Section "ServerLayout"
  Identifier "Layout0"
  Screen 0 "Screen0" 0 0
  Screen 1 "Screen1" RightOf "Screen0"
EndSection

Section "Screen"
  Identifier "Screen0"
EndSection

Section "Screen"
  Identifier "Screen1
EndSection
```

The easiest way to get audio working is to run pulseadudio in system mode. This is fine as there will really only be one user which need audio in this scenario. We need to do a few things to get that working...

```sh
$ usermod -a -G pulse audio
$ vi /etc/pulse/system.pa

Change:

load-module module-native-protocol-unix

To:

load-module module-native-protocol-unix auth-anonymous=1

Comment Out:

#load-module module-suspend-on-idle

$ vi /usr/lib/systemd/system/pulseaudio.service

[Unit]
Description=PulseAudio System Service

[Service]
Type=notify
ExecStart=/bin/pulseaudio --system --realtime --disallow-exit --no-cpu-limit

[Install]
WantedBy=multi-user.target
```

Now we need to load some new SELinux rules to allow pulseaudio to run like this. The module and source file are location in the selinux directory.

```sh
$ semodule -i ./selinux/pulseaudio_system.pp
$ systemctl enable --now pulseaudio
```

Now we need to configure a user to use OVT as their login shell and have systemd auto login as that user on tty1. You can also optionally choose to disable the other tty's if desired.

```sh
$ usermod --shell <path to client.py> <user>
$ cd /usr/lib/systemd/system
$ cp getty@.service getty@tty1.service
$ vi getty@tty1.service

CHANGE:

ExecStart=/sbin/agetty --noclear %I $TERM

TO:

ExecStart=/sbin/agetty -a <user> %I $TERM
```

Now let's configure OVT...

```sh
$ cp settings.conf.sample settings.conf
$ vi settings.conf
```

set the values as you see fit, make sure you set the oVirt API URL! After setting the URL run genhash.py.

```sh
$ python genhash.py
```

Make sure so set mpwordhash in settings.conf to the hash generated by genhash.py!

At this point you should have a working VDI terminal, just reboot and enjoy!

# License

OVT is licensed under the MIT license, see LICENSE for more information.
